---
globs: **/Dockerfile,**/docker-compose.yml,**/portainer-stack.yml
description: Docker and containerization patterns
---

# Docker Patterns

## Dockerfile Structure

### Backend Dockerfile

```dockerfile
FROM node:18-alpine
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install --production

# Copy application files
COPY . .

EXPOSE 80
CMD ["node", "server.js"]
```

**Build Context**: 
- KitchenHub: `./kitchenhub/backend` (context is backend directory)
- VehicleHub: `./vehiclehub` (context is project root, Dockerfile uses `backend/` paths)

### Frontend Dockerfile

```dockerfile
# Build stage
FROM node:18-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Production stage
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

## Docker Compose

- Each service has its own `docker-compose.yml`
- Uses environment variables from `.env` file
- Backend exposes port 80 internally, mapped to unique host port
- Frontend exposes port 80 internally, mapped to unique host port
- Both services on same network for communication

## Portainer Stack

- Similar to docker-compose but uses published images
- Uses environment variables for configuration
- Image names: `{username}/{service}-{backend|frontend}:{tag}`
- Supports health checks for backend service

## Port Allocation

- **KitchenHub**: Backend 8080, Frontend 8081
- **VehicleHub**: Backend 8090, Frontend 8091
- Future services: Increment by 10 (8100/8110, 8120/8130, etc.)

## Health Checks

Backend services must implement `/api/health` endpoint for container health checks:
- Returns 200 when ready
- Returns 503 when not ready
- Does not query database
